generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "sqlserver"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

// Tabla de usuarios
model Consumer {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  username  String    @unique
  password  String
  rolId     Int       @default(2)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  profile   Profile?
  role      Role      @relation(fields: [rolId], references: [id])
  passwordResetTokens PasswordResetToken[]
}

// Tabla de perfiles
model Profile {
  id            Int    @id @default(autoincrement())
  userId        Int    @unique
  name          String @default("")
  firstSurname  String @default("")
  secondSurname String @default("")
  bio           String @default("")
  location      String @default("")
  pronoun       String @default("")
  profileImage  String @default("")

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  consumers     Consumer  @relation(fields: [userId], references: [id])
  games         ProfileGame[]
  comments      Comment[]
}

// Tabla de juegos
model Game {
  id           Int             @id @default(autoincrement())
  title        String
  description  String?
  platform     String?
  genre        String?
  releaseDate  DateTime?
  imageUrl     String?

  profiles     ProfileGame[]
  comments     Comment[]
}

// Tabla de relaciones entre perfiles y juegos
model ProfileGame {
  id         Int           @id @default(autoincrement())
  profileId  Int
  gameId     Int

  rating     Float?  
  liked      Boolean?
  played     Boolean?
  playing    Boolean?
  wishlist   Boolean?

  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  profile    Profile      @relation(fields: [profileId], references: [id], onDelete: Cascade)
  game       Game         @relation(fields: [gameId], references: [id], onDelete: Cascade)

  @@unique([profileId, gameId])
}

// Tabla de comentarios
model Comment {
  id         Int      @id @default(autoincrement())
  profileId  Int
  gameId     Int
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  profile    Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  game       Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)
}

// Tabla de tokens de restablecimiento de contraseña
model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  userId    Int
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  user      Consumer    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Tabla donde se definen los roles del usuario en la aplicación
model Role {
  id        Int      @id @default(autoincrement())
  name      String   @unique

  consumers Consumer[]
}

